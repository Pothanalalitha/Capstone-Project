package com.example.wipro.lalitha.mapper;

import com.example.wipro.lalitha.dto.MedicalRecordDTO;
import com.example.wipro.lalitha.dto.MedicineDTO;
import com.example.wipro.lalitha.mongo.documents.MedicalRecordDocument;
import com.example.wipro.lalitha.mongo.documents.MedicineDocument;

import java.util.List;
import java.util.stream.Collectors;

public class MedicalRecordMapper {

    // Map MongoDB document to DTO
    public static MedicalRecordDTO toDTO(MedicalRecordDocument doc) {
        if (doc == null) return null;
        MedicalRecordDTO dto = new MedicalRecordDTO();
        dto.setId(doc.getId() != null ? Long.valueOf(doc.getId().hashCode()) : null); // or keep as String if preferred
        dto.setPatientId(doc.getPatientId());
        dto.setDescription(doc.getDescription());
        dto.setIssue(doc.getIssue());
        dto.setDoctorName(doc.getDoctorName());
        dto.setTreatedAt(doc.getTreatedAt());
        // dto does not have patientId? If not, remove that line
        dto.setMedicines(
            doc.getMedicines() == null ? null :
                doc.getMedicines().stream()
                    .map(MedicalRecordMapper::toMedicineDTO)
                    .collect(Collectors.toList())
        );
        return dto;
    }

    // Map DTO to MongoDB document
    public static MedicalRecordDocument toDocument(MedicalRecordDTO dto) {
        if (dto == null) return null;
        MedicalRecordDocument doc = new MedicalRecordDocument();
        doc.setId(dto.getId() != null ? dto.getId().toString() : null);
        doc.setPatientId(dto.getPatientId());
        doc.setDescription(dto.getDescription());
        doc.setIssue(dto.getIssue());
        doc.setDoctorName(dto.getDoctorName());
        doc.setTreatedAt(dto.getTreatedAt());
        doc.setMedicines(dto.getMedicines() == null ? null :
            dto.getMedicines().stream()
                .map(MedicalRecordMapper::toMedicineDocument)
                .collect(Collectors.toList())
        );
        return doc;
    }

    // Medicine document to DTO
    private static MedicineDTO toMedicineDTO(MedicineDocument md) {
        MedicineDTO dto = new MedicineDTO();
        dto.setName(md.getName());
        dto.setQuantity(md.getQuantity());
        dto.setTime(md.getTime());
        return dto;
    }

    // Medicine DTO to document
    private static MedicineDocument toMedicineDocument(MedicineDTO dto) {
        MedicineDocument md = new MedicineDocument();
        md.setName(dto.getName());
        md.setQuantity(dto.getQuantity());
        md.setTime(dto.getTime());
        return md;
    }
}
